import src.valladopy.astro.sgp4.deep_space as deep_space

from ...conftest import custom_isclose


def test_dscom():
    # Inputs
    epoch = 20630.3321544402
    ecco = 0.6877146
    argpo = 4.62102273937204
    tc = 0
    inclo = 1.11977881347003
    nodeo = 4.87072001413786
    no = 0.00874854701963024

    # Expected outputs
    expected = {
        "sinim": 0.9000040530708066,
        "cosim": 0.43588152571096744,
        "sinomm": -0.9958290077603604,
        "cosomm": -0.09123917636090341,
        "snodm": -0.9874918050265551,
        "cnodm": 0.1576703364789844,
        "day": 38891.8321544402,
        "e3": -0.0004408046133189452,
        "ee2": -0.00010934280539371682,
        "em": 0.6877146,
        "emsq": 0.47295137105315993,
        "gam": 81.45518530246459,
        "peo": 0.0,
        "pgho": 0.0,
        "pho": 0.0,
        "pinco": 0.0,
        "plo": 0.0,
        "rtemsq": 0.7259811491676903,
        "se2": 0.002501941522642442,
        "se3": 0.0010072419885301294,
        "sgh2": -0.0012619155097006827,
        "sgh3": 0.0024557462815411137,
        "sgh4": -7.471990261373485e-05,
        "sh2": 0.0009458037270824905,
        "sh3": -0.0039702236906196215,
        "si2": -0.0011105699174389198,
        "si3": 2.735745904365566e-05,
        "sl2": 0.004083492666433351,
        "sl3": -0.0021191158730878784,
        "sl4": 0.00028883025414443424,
        "s1": -0.00041062096260820945,
        "s2": -3.7762516647879394e-05,
        "s3": 5.482975046298304e-05,
        "s4": 3.9805365249694126e-05,
        "s5": 0.31998284015161715,
        "s6": 0.13314323348129373,
        "s7": 0.5367536651307488,
        "ss1": -0.0025565158178131146,
        "ss2": -0.0002351084818405826,
        "ss3": 0.0003413686516513944,
        "ss4": 0.0002478272060157043,
        "ss5": 0.2645498128235839,
        "ss6": -0.4893264311547745,
        "ss7": -0.19699506287266796,
        "sz1": 2.8238981585147584,
        "sz2": -5.981059840555326,
        "sz3": 5.92775064004244,
        "sz11": 0.558009419050828,
        "sz12": 2.3618244410934346,
        "sz13": 0.49982891694923726,
        "sz21": 0.9668540331305209,
        "sz22": 2.011419834108327,
        "sz23": -7.4765327378147886,
        "sz31": -1.967387569689543,
        "sz32": -2.5459583917124857,
        "sz33": 2.9871658891940194,
        "xgh2": 0.00045492024438304547,
        "xgh3": -2.4648151078780584e-05,
        "xgh4": -3.9335661939747734e-05,
        "xh2": -0.000643834081488179,
        "xh3": 0.00030794292793480735,
        "xi2": 0.00011424082985421915,
        "xi3": 0.00012000896281452939,
        "xl2": -0.000786264377199412,
        "xl3": -0.0004559423560477619,
        "xl4": 0.0001520522489667763,
        "nm": 0.00874854701963024,
        "z1": 2.9000521897762903,
        "z2": 7.170052485741651,
        "z3": 7.057852947556323,
        "z11": 1.3641748695340274,
        "z12": -1.5126220389317524,
        "z13": -0.22482095843959166,
        "z21": -5.118745162782586,
        "z22": -8.524777194958673,
        "z23": -1.041382803617624,
        "z31": 1.0839759284758543,
        "z32": 5.71430812818055,
        "z33": 0.7743675261390615,
        "zmol": 1.703291771983622,
        "zmos": 2.9721580403249774,
    }

    # Call dscom method
    dscom_out = deep_space.dscom(epoch, ecco, argpo, tc, inclo, nodeo, no)

    # Check results
    for key, value in expected.items():
        assert custom_isclose(getattr(dscom_out, key), value)
